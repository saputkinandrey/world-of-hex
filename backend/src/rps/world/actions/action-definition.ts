import {ActionTag} from "./action-tags";
import {NeedGate, NeedTag, NeedThresholdEnum, NeedThresholds} from "../needs/needs";
import {MemeId} from "../memes";
import {MorphId} from "../morphs";
import {ActionContext} from "./action-context";

export interface ActionDefinition {
    tag: ActionTag; // –¢–∏–ø –¥–µ–π—Å—Ç–≤–∏—è
    ctx?: ActionContext;
    need?: NeedTag; // –ö–∞–∫–∞—è –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è–µ—Ç—Å—è

    /**
     * –ü–æ—Ä–æ–≥–æ–≤—ã–µ —É—Å–ª–æ–≤–∏—è –í–•–û–î–ê –≤ —ç–∫—à–µ–Ω:
     * —ç–∫—à–µ–Ω –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –ø—É–ª –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤, –µ—Å–ª–∏ –¥–ª—è –≤—Å–µ—Ö –Ω—É–∂–¥
     * –∑–æ–Ω–∞ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º—É NeedGate.
     */
    enterThresholds?: Partial<Record<NeedTag, NeedGate>>;

    /**
     * –ü–æ—Ä–æ–≥–æ–≤—ã–µ —É—Å–ª–æ–≤–∏—è –í–´–•–û–î–ê –∏–∑ —ç–∫—à–µ–Ω–∞:
     * —ç–∫—à–µ–Ω –ú–û–ñ–ù–û –∑–∞–≤–µ—Ä—à–∏—Ç—å, –µ—Å–ª–∏ –¥–ª—è –≤—Å–µ—Ö –Ω—É–∂–¥
     * –∑–æ–Ω–∞ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º—É NeedGate.
     *
     * –ü–æ–∫–∞ —ç–∫—à–µ–Ω –∞–∫—Ç–∏–≤–µ–Ω, –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —ç—Ç–∏ –≥–µ–π—Ç—ã
     * –∏ –Ω–µ –¥–∞—ë—Ç –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –¥—Ä—É–≥–æ–π —ç–∫—à–µ–Ω, –ø–æ–∫–∞
     * exitThresholds –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã.
     */
    exitThresholds?: Partial<Record<NeedTag, NeedGate>>;

    // === –°—Ç–æ–∏–º–æ—Å—Ç—å, –Ω–∞–≥—Ä–∞–¥–∞ –∏ —Ä–∏—Å–∫ ===
    costEnergy?: number; // –≠–Ω–µ—Ä–≥–∏—è, –ø–æ—Ç—Ä–∞—á–µ–Ω–Ω–∞—è –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (0‚Äì1)
    costTime?: number; // –í—Ä–µ–º—è (–≤ —É—Å–ª–æ–≤–Ω—ã—Ö —á–∞—Å–∞—Ö)
    risk?: number; // –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –Ω–µ—É–¥–∞—á–∏ (0‚Äì1)
    rewardSatisfaction?: number; // –ù–∞—Å–∫–æ–ª—å–∫–æ —Å–Ω–∏–∂–∞–µ—Ç –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å (0‚Äì1)
    rewardSecondary?: {
        // –ü–æ–±–æ—á–Ω—ã–µ –≤—ã–≥–æ–¥—ã (–≤—Ç–æ—Ä–∏—á–Ω—ã–µ –Ω—É–∂–¥—ã)
        [need in NeedTag]?: number;
    };

    targetType?: string;

    requiresItem?: string[];

    // === –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã ===
    moralWeight?: number; // –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –Ω–æ—Ä–º–∞–º –∫—É–ª—å—Ç—É—Ä—ã (-1‚Ä¶1)
    groupAffinity?: number; // –ü–æ–≤—ã—à–∞–µ—Ç –∏–ª–∏ —Å–Ω–∏–∂–∞–µ—Ç —á—É–≤—Å—Ç–≤–æ –µ–¥–∏–Ω—Å—Ç–≤–∞ (-1‚Ä¶1)
    respectGain?: number; // –£–≤–∞–∂–µ–Ω–∏–µ/—Ä–µ–ø—É—Ç–∞—Ü–∏—è –∑–∞ —É—Å–ø–µ—à–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
    shameGain?: number; // –ü–æ—Ç–µ—Ä—è —á–µ—Å—Ç–∏ –ø—Ä–∏ –ø–æ–∑–æ—Ä–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏—è—Ö (–Ω–∞–ø—Ä. BEG_FOR_FOOD)

    // === –ú–µ—Ö–∞–Ω–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è ===
    skillRequired?: string; // –ù–∞–≤—ã–∫, –ø–æ–≤—ã—à–∞—é—â–∏–π —à–∞–Ω—Å —É—Å–ø–µ—Ö–∞
    requiresSkill?: string; // –ù–∞–≤—ã–∫, –ø–æ–≤—ã—à–∞—é—â–∏–π —à–∞–Ω—Å —É—Å–ø–µ—Ö–∞
    successFormula?: string; // –§–æ—Ä–º—É–ª–∞ —É—Å–ø–µ—Ö–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä: "Survival * 0.8 + Luck * 0.2"
    resourceInput?: string[]; // –¢—Ä–µ–±—É–µ–º—ã–µ —Ä–µ—Å—É—Ä—Å—ã (–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã)
    resourceOutput?: string[]; // –ü—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã–µ —Ä–µ—Å—É—Ä—Å—ã
    locationType?: string; // –¢–∏–ø –º–µ—Å—Ç–∞ (–ª–µ—Å, –ø–æ–ª–µ, –¥–æ–º, —Ä—ã–Ω–æ–∫)
    requiresLocation?: string; // –¢–∏–ø –º–µ—Å—Ç–∞ (–ª–µ—Å, –ø–æ–ª–µ, –¥–æ–º, —Ä—ã–Ω–æ–∫)
    actorLimit?: number; // –°–∫–æ–ª—å–∫–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –º–æ–≥—É—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å
    cooldown?: number; // –ß–µ—Ä–µ–∑ —Å–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –º–æ–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ

    // === –ü—Å–∏—Ö–æ–ª–æ–≥–∏—è ===
    emotionalImpact?: number; // –í–ª–∏—è–µ—Ç –Ω–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ (-1‚Ä¶1)
    autonomyChange?: number; // –ß—É–≤—Å—Ç–≤–æ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏/–ø–æ–¥—á–∏–Ω—ë–Ω–Ω–æ—Å—Ç–∏
    obedienceModifier?: number; // –°–∫–ª–æ–Ω–Ω–æ—Å—Ç—å –∫ –ø–æ–≤–∏–Ω–æ–≤–µ–Ω–∏—é –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

    // === –ü—Ä–æ—á–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ===
    visibleToOthers?: boolean; // –í–∏–¥–Ω–æ –ª–∏ –¥—Ä—É–≥–∏–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫—Ä–∞–∂–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–∫—Ä—ã—Ç–æ–π)
    producesWaste?: boolean; // –°–æ–∑–¥–∞—ë—Ç –ª–∏ –º—É—Å–æ—Ä/–æ—Ç—Ö–æ–¥—ã
    environmentalImpact?: number; // –í–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–∏—Ä–æ–¥—É (-1‚Ä¶1)
    temperatureEffect?: number;
    // üîΩ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ø–æ–ª—è
    tradeEffect?: {
        [k: string]: number | string; // –±–∞–ª–∞–Ω—Å, —Ä–µ—Å—É—Ä—Å–Ω—ã–µ –¥–µ–ª—å—Ç—ã, –ø–æ–º–µ—Ç–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–π
    };
    socialImpact?: {
        [k: string]: number; // —Å–¥–≤–∏–≥–∏ –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö/—Ä–µ–ø—É—Ç–∞—Ü–∏–∏/–∞—Ñ—Ñ–µ–∫—Ç–∞—Ö
    };
    ownershipEffect?: {
        [k: string]: string | boolean; // –¥–æ—Å—Ç—É–ø—ã/–ø—Ä–∞–≤–∞/–æ–±–ª–∞—Å—Ç–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
    };
    lawEffect?: {
        [k: string]: string | boolean; // —É–∫–∞–∑—ã/–ø—Ä–∞–≤–∏–ª–∞/—Ñ–ª–∞–≥–∏ –∏—Å–ø–æ–ª–Ω–∏–º–æ—Å—Ç–∏
    };
    requiredMemes?: MemeId[];  // –ø–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–µ / –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
    requiredMorphs?: MorphId[]; // —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ/–º–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

    needMemes?: boolean;
    needRework?: boolean;
    unclearAction?: boolean;

    /**
     * –í—Ö–æ–¥ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.
     * durationSeconds ‚Äî —Å–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –∞–∫—Ç–æ—Ä –ø–ª–∞–Ω–∏—Ä—É–µ—Ç –ø—Ä–æ–≤–µ—Å—Ç–∏ –≤ —ç—Ç–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.
     */
    onEnter?(ctx: ActionContext): void;

    /**
     * –®–∞–≥ —Å–∏–º—É–ª—è—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ —ç—Ç–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è.
     *
     * deltaSeconds ‚Äî "—Å–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–æ—à–ª–æ" –≤ —Å–µ–∫—É–Ω–¥–∞—Ö.
     *
     * –°—Ç—Ä–∞—Ç–µ–≥–∏—è –º–æ–∂–µ—Ç:
     *  - —É–º–µ–Ω—å—à–∞—Ç—å state.remainingSeconds;
     *  - –æ–±–Ω–æ–≤–ª—è—Ç—å –Ω—É–∂–¥—ã/–º–µ—Ç–∞–±–æ–ª–∏–∑–º/–ø–æ–∑—É –∞–∫—Ç—ë—Ä–∞;
     *  - –ø–æ —Å–≤–æ–µ–º—É —É—Å–º–æ—Ç—Ä–µ–Ω–∏—é —Ä–µ—à–∞—Ç—å, –∫–æ–≥–¥–∞ —Å—á–∏—Ç–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–º.
     *
     * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
     *  - true  ‚Äî –µ—Å–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω—É–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å (–ø–µ—Ä–µ–π—Ç–∏ –≤ idle);
     *  - false ‚Äî –µ—Å–ª–∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –≤ —ç—Ç–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.
     */
    perform(deltaTime: number): void;

    /**
     * –í—ã—Ö–æ–¥ –∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).
     */
    onExit?(ctx: ActionContext): void;

}

// –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –¥–∏—Å–∫—Ä–µ—Ç–Ω—É—é –∑–æ–Ω—É –ø–æ level‚àà[0..1] –∏ –ø–æ—Ä–æ–≥–∞–º
export function zoneOf(
    level: number,
    t: NeedThresholds,
): NeedThresholdEnum | null {
    if (level >= t.critical) return NeedThresholdEnum.CRITICAL;
    if (level >= t.severe) return NeedThresholdEnum.SEVERE;
    if (level >= t.impaired) return NeedThresholdEnum.IMPAIRED;
    if (level >= t.warn) return NeedThresholdEnum.WARN;
    return null; // –Ω–∏–∂–µ warn ‚Äî ¬´–Ω–æ—Ä–º–∞–ª—å–Ω–æ¬ª
}

const order = [
    NeedThresholdEnum.WARN,
    NeedThresholdEnum.IMPAIRED,
    NeedThresholdEnum.SEVERE,
    NeedThresholdEnum.CRITICAL,
] as const;

export const Idle: ActionDefinition = {
    tag: 'IDLE',

    onEnter(ctx: ActionContext) {
        ctx.actor.setAction(this)
    },

    // rewardSecondary –∑–¥–µ—Å—å –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º: —ç—Ñ—Ñ–µ–∫—Ç—ã –∏–¥—É—Ç
    // —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É –º–µ—Ç–∞–±–æ–ª–∏–∑–º–∞ / NutritionContent.
    perform(deltaTime) {
    }
};
